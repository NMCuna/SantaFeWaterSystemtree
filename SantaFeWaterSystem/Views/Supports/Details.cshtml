@model SantaFeWaterSystem.Models.Support

@{
    ViewData["Title"] = "Support Ticket Details";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        h2 {
            color: #0d6efd;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .ticket-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.03);
        }

            .ticket-info strong {
                width: 120px;
                display: inline-block;
            }

        .section-title {
            margin-top: 25px;
            margin-bottom: 10px;
            color: #0d6efd;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feedback {
            background-color: #fff3cd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 0 8px rgba(0,0,0,0.05);
        }

        .btn-back {
            margin-top: 20px;
        }
    </style>
}

<h2><i class="bi bi-chat-left-text-fill"></i> @Model.Subject</h2>

<div class="ticket-info">
    <p><strong><i class="bi bi-person-fill"></i> Consumer:</strong> @Model.Consumer?.FirstName</p>
    <p><strong><i class="bi bi-info-circle-fill"></i> Status:</strong> @Model.Status</p>
    <p><strong><i class="bi bi-calendar-fill"></i> Created At:</strong> @Model.CreatedAt.ToString("yyyy-MM-dd HH:mm")</p>
    @if (Model.IsResolved && Model.ResolvedAt.HasValue)
    {
        <p><strong><i class="bi bi-check-circle-fill text-success"></i> Resolved At:</strong> @Model.ResolvedAt.Value.ToString("yyyy-MM-dd HH:mm")</p>
    }
</div>

<h4 class="section-title"><i class="bi bi-envelope-fill"></i> User Message</h4>
<p>@Model.Message</p>

@if (!string.IsNullOrEmpty(Model.AdminReply))
{
    <h4 class="section-title"><i class="bi bi-person-badge-fill"></i> Admin Reply</h4>
    <p>@Model.AdminReply</p>
}
else
{
    <p><em>No reply yet.</em></p>
}

@if (Model.IsResolved)
{
    <h4 class="section-title"><i class="bi bi-emoji-smile-fill"></i> User Feedback</h4>
    <div class="feedback">
        @if (!string.IsNullOrEmpty(Model.SupportFeedbackEmoji) || !string.IsNullOrEmpty(Model.SupportFeedbackNote))
        {
            @if (!string.IsNullOrEmpty(Model.SupportFeedbackEmoji))
            {
                <p><strong>Emoji:</strong> @Model.SupportFeedbackEmoji</p>
            }

            @if (!string.IsNullOrEmpty(Model.SupportFeedbackNote))
            {
                <p><strong>Note:</strong> @Model.SupportFeedbackNote</p>
            }

            @if (Model.SupportFeedbackAt.HasValue)
            {
                <p><strong>Submitted At:</strong> @Model.SupportFeedbackAt.Value.ToString("yyyy-MM-dd HH:mm")</p>
            }
        }
        else
        {
            <p><em>No feedback given.</em></p>
        }
    </div>
}

<a asp-action="Index" class="btn btn-secondary btn-back"><i class="bi bi-arrow-left-circle"></i> Back to List</a>
